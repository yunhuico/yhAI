function calculateService(){var a=function(a){var b=0,c=0;_.each(a.slaves,function(a){b+=a.resources.cpus,c+=a.used_resources.cpus});var d=100*c/b;return[parseFloat(d.toFixed(2)),c.toFixed(2),b.toFixed(2)]},b=function(a){var b=0,c=0;_.each(a.slaves,function(a){b+=a.resources.mem,c+=a.used_resources.mem});var d=100*c/b;return[parseFloat(d.toFixed(2)),(c/1024).toFixed(3),(b/1024).toFixed(3)]},c=function(a){var b=0,c=0;_.each(a.slaves,function(a){b+=a.resources.disk,c+=a.used_resources.disk});var d=100*c/b;return parseFloat(d.toFixed(2))},d=function(a){var b=0,c=0;_.each(a.frameworks,function(a){b+=a.tasks.length,c+=_.filter(a.tasks,function(a){return"TASK_FAILED"==a.state}).length});var d=100*c/b;return parseFloat(d.toFixed(2))},e=function(a,b){var c=0;_.each(a.slaves,function(a){c+=a.resources.cpus});var d=_.find(a.frameworks,function(a){return a.id==b}),e=d.used_resources.cpus,f=100*e/c;return[parseFloat(f.toFixed(2)),e]},f=function(a,b){var c=0;_.each(a.slaves,function(a){c+=a.resources.mem});var d=_.find(a.frameworks,function(a){return a.id==b}),e=d.used_resources.mem,f=100*e/c;return[parseFloat(f.toFixed(2)),e]},g=function(a,b){var c=0;_.each(a.slaves,function(a){c+=a.resources.disk});var d=_.find(a.frameworks,function(a){return a.id==b}),e=d.used_resources.disk,f=100*e/c;return[parseFloat(f.toFixed(2)),e]},h=function(a,b){var c=0;_.each(a.slaves,function(a){switch(b){case"services.cpu":c+=a.resources.cpus;break;case"services.memory":c+=a.resources.mem;break;case"services.disk":c+=a.resources.disk}});var d=0;_.each(a.frameworks,function(a){switch(b){case"services.cpu":d+=a.used_resources.cpus;break;case"services.memory":d+=a.used_resources.mem;break;case"services.disk":d+=a.used_resources.disk}});var e=100*d/c;return parseFloat(e.toFixed(2))},i=function(a,b){var c=_.find(a.slaves,function(a){return a.id==b}),d=c.resources.cpus,e=c.used_resources.cpus,f=100*e/d;return[parseFloat(f.toFixed(2)),e]},j=function(a,b){var c=_.find(a.slaves,function(a){return a.id==b}),d=c.resources.mem,e=c.used_resources.mem,f=100*e/d;return[parseFloat(f.toFixed(2)),e]},k=function(a,b){var c=_.find(a.slaves,function(a){return a.id==b}),d=c.resources.disk,e=c.used_resources.disk,f=100*e/d;return[parseFloat(f.toFixed(2)),e]};return{calculateCpuAllocationRate:a,calculateMemoryAllocationRate:b,calculateDiskAllocationRate:c,calculateTaskFailureRate:d,calculateCpuAllocationRateForService:e,calculateMemAllocationRateForService:f,calculateDiskAllocationRateForService:g,calculateAllocationRateForAllServices:h,calculateCpuAllocationRateForNode:i,calculateMemAllocationRateForNode:j,calculateDiskAllocationRateForNode:k}}function chartsService(){var a=function(a,b,c,d){var e=new google.visualization.DataTable;e.addColumn("string",a[0]);for(var f=1;f<a.length;f++)e.addColumn("number",a[f]);e.addRows(b),c in window.charts||(window.charts[c]=new google.visualization.LineChart(document.getElementById(c)));var g={curveType:"function",height:200,focusTarget:"category",vAxis:{title:d},legend:"none"};window.charts[c].draw(e,g)},b=function(a,b){var c=google.visualization.arrayToDataTable(a),d={pieHole:0,pieSliceText:"value-and-percentage",legend:{position:"bottom"},chartArea:{width:"100%",height:"70%"}},e=new google.visualization.PieChart(document.getElementById(b));e.draw(c,d)};return{drawLineChart:a,drawDonutChart:b}}function mesosAPIService(a,b,c){var d=function(){var c=b.defer(),d="/mesos/master/state.json",e={url:d,dataType:"json",method:"GET"};return a(e).success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise},e=function(){var c=b.defer(),d="/clusterStateSummary",e={url:d,dataType:"json",method:"GET"};return a(e).success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),c.promise},f=function(){c.open({templateUrl:"templates/common/fail.html",controller:"ActionSuccessBoxCtrl",size:"sm",resolve:{model:function(){return{id:message}}}})};return{getClusterState:d,getClusterStateSummary:e,errorResponse:f}}function popupService(a,b){var c=function(a){b.open({templateUrl:"templates/servicepopup.html",controller:"servicePopupController",size:"lg",resolve:{model:function(){return{serviceid:a}}}})},d=function(a){b.open({templateUrl:"templates/nodepopup.html",controller:"nodePopupController",size:"lg",resolve:{model:function(){return{nodeid:a}}}})};return{openServicePopup:c,openNodePopup:d}}var linkerCloud=angular.module("LinkerCloud",["ngRoute","ui.router","ui.bootstrap","pascalprecht.translate","ngCookies"]);linkerCloud.run(["$rootScope","$state","$stateParams",function(a,b,c){a.$state=b,a.$stateParams=c}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/dashboard"),a.state("dashboard",{url:"/dashboard",templateUrl:"templates/dashboard.html",controller:"DashboardController"}).state("services",{url:"/services",templateUrl:"templates/services.html",controller:"ServicesController"}).state("nodes",{url:"/nodes",templateUrl:"templates/nodes.html",controller:"NodesController"})}]).config(["$translateProvider",function(a){var b=-1!=window.navigator.language.indexOf("zh")?"zh":"en";a.useStaticFilesLoader({prefix:"/locales/",suffix:".json"}),a.useLocalStorage(),a.useSanitizeValueStrategy("escape"),a.preferredLanguage(b)}]).run(["$rootScope","$translate",function(a,b){a.$translate=b}]).run(["$rootScope",function(a){$(window).load(function(){a.loaded=!0})}]),linkerCloud.controller("DashboardController",["$scope","$timeout","$location","chartsService","calculateService","popupService",function(a,b,c,d,e,f){function g(a){if(0!=a.length){var c=a.shift();c(),b(function(){g(a)},0)}}function h(b){if(0!=window.clusterState.length){for(var c=["Time(s)","Allocation Rate(占用率)"],f=[],g=0;g<window.clusterState.length;g++){var h=window.clusterState[g],i=[];i.push(g+1-window.clusterState.length+"s"),i.push(e.calculateCpuAllocationRate(h)[0]),f.push(i)}a.currentCpuAllocationRate=f[f.length-1][1];var j=e.calculateCpuAllocationRate(window.clusterState[window.clusterState.length-1]);a.currentUsedCPU=j[1],a.currentTotalCPU=j[2],a.cpuLabelData={used:a.currentUsedCPU,total:a.currentTotalCPU},d.drawLineChart(c,f,b,"%(百分比)")}}function i(b){if(0!=window.clusterState.length){for(var c=["Time(s)","Allocation Rate(占用率)"],f=[],g=0;g<window.clusterState.length;g++){var h=window.clusterState[g],i=[];i.push(g+1-window.clusterState.length+"s"),i.push(e.calculateMemoryAllocationRate(h)[0]),f.push(i)}a.currentMemoryAllocationRate=f[f.length-1][1];var j=e.calculateMemoryAllocationRate(window.clusterState[window.clusterState.length-1]);a.currentUsedMem=j[1],a.currentTotalMem=j[2],a.memLabelData={used:a.currentUsedMem,total:a.currentTotalMem},d.drawLineChart(c,f,b,"%(百分比)")}}function j(b){if(0!=window.clusterState.length){for(var c=["Time(s)","Task Failure Rate(任务失败率)"],f=[],g=0;g<window.clusterState.length;g++){var h=window.clusterState[g],i=[];i.push(g+1-window.clusterState.length+"s"),i.push(e.calculateTaskFailureRate(h)),f.push(i)}a.currentTaskFailureRate=f[f.length-1][1],d.drawLineChart(c,f,b,"%(百分比)")}}function k(){if(0!=window.clusterState.length){a.services4health=[];var b=window.clusterState[window.clusterState.length-1];_.each(b.frameworks,function(b){var c={id:b.id,name:b.name,status:"status.service.healthy",status_color:"#2ecc71"};0==b.tasks.length?(c.status="status.service.idle",c.status_color="burlywood"):_.each(b.tasks,function(a){"TASK_ERROR"!=a.state&&"TASK_FAILED"!=a.state&&"TASK_KILLED"!=a.state&&"TASK_LOST"!=a.state||(c.status="status.service.unhealthy",c.status_color="#ed5565")}),a.services4health.push(c)})}}function l(b){if(0!=window.clusterState.length){var c=window.clusterState[window.clusterState.length-1];a.task_running=0,a.task_staging=0,a.totalTaskNum=0,_.each(c.frameworks,function(b){a.task_running+=_.filter(b.tasks,function(a){return"TASK_RUNNING"==a.state}).length,a.task_staging+=_.filter(b.tasks,function(a){return"TASK_STAGING"==a.state}).length}),a.totalTaskNum=a.task_running+a.task_staging;var e=[["Name","Number"],["Task Running(运行中)",a.task_running],["Task Staging(启动中)",a.task_staging]];d.drawDonutChart(e,b)}}function m(b){if(0!=window.clusterState.length){for(var c=["Time","Connected Nodes"],e=[],f=0;f<window.clusterState.length;f++){var g=window.clusterState[f],h=[];h.push(f+1-window.clusterState.length+"s"),h.push(g.slaves.length),e.push(h)}a.currentConnectedNodes=e[e.length-1][1],d.drawLineChart(c,e,b,"")}}a.showDashboard=function(){if("/dashboard"!=c.path())return void b.cancel(a.refreshDashboard);var d=[];d.push(function(){h("cpu-allocation-chart")}),d.push(function(){i("memory-allocation-chart")}),d.push(function(){j("task-failure-rate-chart")}),d.push(function(){k()}),d.push(function(){l("tasks-chart")}),d.push(function(){m("nodes-chart")}),g(d),a.refreshDashboard=b(a.showDashboard,1e3)},a.openServicePopup=function(a){f.openServicePopup(a)};var n=function(){window.charts={},a.showDashboard()};n()}]),linkerCloud.controller("MainController",["$scope","$location","$timeout","mesosAPIService",function(a,b,c,d){function e(){var c=b.path();_.each(a.navigators,function(d){""!=c?d.href!=c?d.ngclass="default":(d.ngclass="active",a.selectedTab=d.name,a.selectedTabIcon=d.icon):(a.selectthis("titles.dashboard"),b.path("/dashboard"))})}a.navigators=[{name:"titles.dashboard",href:"/dashboard",icon:"dashboard.png",ngclass:"active"},{name:"titles.services",href:"/services",icon:"services.png",ngclass:"default"},{name:"titles.nodes",href:"/nodes",icon:"nodes.png",ngclass:"default"}],a.selectthis=function(b){a.selectedTab=b,_.each(a.navigators,function(c){c.name!=b?c.ngclass="default":(c.ngclass="active",a.selectedTabIcon=c.icon)})},a.getData=function(){d.getClusterState().then(function(b){60==window.clusterState.length&&window.clusterState.shift(),window.clusterState.push(b),a.getData()},function(b){console.log("error get data"),a.getData()})},a.languageSwitch=function(b){a.selectedLang=b,a.$translate.use(b.name)},a.mouseover=function(a){a.ngclass="hover"},a.mouseleave=function(a){a.ngclass="default"};var f=function(){a.supportedLangs=[{name:"en",display:"English"},{name:"zh",display:"中文"}];var b=a.$translate.storage(),c=a.$translate.storageKey(),d=b.get(c)||(-1!=window.navigator.language.indexOf("zh")?"zh":"en");a.selectedLang=_.find(a.supportedLangs,function(a){return a.name==d}),a.$translate.use(a.selectedLang.name),window.clusterState=[],a.getData(),e()};f()}]),linkerCloud.controller("NodesController",["$scope","$timeout","$filter","$location","calculateService","chartsService","popupService",function(a,b,c,d,e,f,g){function h(){if("/nodes"!=d.path())return void b.cancel(a.refreshNodes);if(0==window.clusterState.length)return void(a.refreshNodes=b(h,1e3));for(var c=["Time(s)","Allocation Rate(占用率)"],g=[],i=0;i<window.clusterState.length;i++){var j=window.clusterState[i],k=[];switch(k.push(i+1-window.clusterState.length+"s"),a.chartFor){case"services.cpu":k.push(e.calculateCpuAllocationRate(j)[0]);break;case"services.memory":k.push(e.calculateMemoryAllocationRate(j)[0]);break;case"services.disk":k.push(e.calculateDiskAllocationRate(j))}g.push(k)}a.nodeNum.nodeNum=window.clusterState[window.clusterState.length-1].slaves.length,f.drawLineChart(c,g,"node-allocation-chart","%(百分比)"),a.getLastestNodes(),a.refreshNodes=b(h,1e3)}a.switchCharts=function(b){switch(a.chartFor=b,b){case"services.cpu":$("#btnForCpu").addClass("btn-group-selected"),$("#btnForMem").removeClass("btn-group-selected"),$("#btnForDisk").removeClass("btn-group-selected"),h();break;case"services.memory":$("#btnForCpu").removeClass("btn-group-selected"),$("#btnForMem").addClass("btn-group-selected"),$("#btnForDisk").removeClass("btn-group-selected"),h();break;case"services.disk":$("#btnForCpu").removeClass("btn-group-selected"),$("#btnForMem").removeClass("btn-group-selected"),$("#btnForDisk").addClass("btn-group-selected"),h()}},a.getLastestNodes=function(){a.nodes=[];var b=window.clusterState[window.clusterState.length-1];_.each(b.slaves,function(b){var c={id:b.id,hostname:b.hostname,services:[],tasks:0,cpu:parseFloat((100*b.used_resources.cpus/b.resources.cpus).toFixed(2)),mem:parseFloat((100*b.used_resources.mem/b.resources.mem).toFixed(2)),disk:parseFloat((100*b.used_resources.disk/b.resources.disk).toFixed(2))};a.nodes.push(c)}),_.each(b.frameworks,function(b){_.each(b.tasks,function(b){var c=_.find(a.nodes,function(a){return a.id==b.slave_id});c.tasks+=1,c.services.indexOf(b.framework_id)<0&&c.services.push(b.framework_id)})}),a.$translate(["nodes.allservices"]).then(function(b){a.allservices_filter=b["nodes.allservices"]}),a.servicesList=[{id:"",name:a.allservices_filter+"("+a.nodeNum.nodeNum+")",selected:!1}],_.each(b.frameworks,function(b){var c={id:b.id,name:b.name,selected:!1},d=_.filter(a.nodes,function(a){return a.services.indexOf(c.id)>=0}).length;c.name+=" ("+d+")",a.servicesList.push(c)});var c=_.find(a.servicesList,function(b){return b.id==a.searchByService.service});_.isUndefined(c)||(c.selected=!0)},a.filterNodes=function(){var b=a.nodes;return b=c("filter")(b,a.searchByService.service),b=c("nodeFilterForSpecifiedFields")(b,a.searchFilter)},a.openNodePopup=function(a){g.openNodePopup(a)},a.changeSortBy=function(b){var c=a.sortBy.substring(1);c==b&&"-"==a.sortBy.substring(0,1)?a.sortBy="+"+b:a.sortBy="-"+b};var i=function(){window.charts={},a.nodeNum={nodeNum:0},a.searchByService={service:""},a.searchFilter="",a.sortBy="-tasks",a.$translate(["nodes.allservices"]).then(function(b){a.allservices_filter=b["nodes.allservices"]}),b(function(){a.switchCharts("services.cpu")},1e3)};i()}]).filter("nodeFilterForSpecifiedFields",[function(){return function(a,b){if(angular.isUndefined(a)||angular.isUndefined(b))return a;var c=[];return angular.forEach(a,function(a){(a.hostname.indexOf(b)>=0||a.tasks.toString().indexOf(b)>=0||a.cpu.toString().indexOf(b)>=0||a.mem.toString().indexOf(b)>=0||a.disk.toString().indexOf(b)>=0)&&c.push(a)}),c}}]),linkerCloud.controller("servicePopupController",["$scope","$window","$timeout","$modalInstance","model","calculateService","chartsService",function(a,b,c,d,e,f,g){function h(a){if(0!=a.length){var b=a.shift();b(),c(function(){h(a)},0)}}function i(b){if(0!=window.clusterState.length){for(var c=["Time(s)","Allocation Rate(占用率)"],d=[],e=0;e<window.clusterState.length;e++){var h=window.clusterState[e],i=[];i.push(e+1-window.clusterState.length+"s"),i.push(f.calculateCpuAllocationRateForService(h,a.serviceid)[0]),d.push(i)}var j=f.calculateCpuAllocationRateForService(window.clusterState[window.clusterState.length-1],a.serviceid);a.currentUsedCPU=j[1],g.drawLineChart(c,d,b,"%(百分比)")}}function j(b){if(0!=window.clusterState.length){for(var c=["Time(s)","Allocation Rate(占用率)"],d=[],e=0;e<window.clusterState.length;e++){var h=window.clusterState[e],i=[];i.push(e+1-window.clusterState.length+"s"),i.push(f.calculateMemAllocationRateForService(h,a.serviceid)[0]),d.push(i)}var j=f.calculateMemAllocationRateForService(window.clusterState[window.clusterState.length-1],a.serviceid);a.currentUsedMem=j[1],g.drawLineChart(c,d,b,"%(百分比)")}}function k(b){if(0!=window.clusterState.length){for(var c=["Time(s)","Allocation Rate(占用率)"],d=[],e=0;e<window.clusterState.length;e++){var h=window.clusterState[e],i=[];i.push(e+1-window.clusterState.length+"s"),i.push(f.calculateDiskAllocationRateForService(h,a.serviceid)[0]),d.push(i)}var j=f.calculateDiskAllocationRateForService(window.clusterState[window.clusterState.length-1],a.serviceid);a.currentUsedDisk=j[1],g.drawLineChart(c,d,b,"%(百分比)")}}function l(){if(0!=window.clusterState.length){var b=window.clusterState[window.clusterState.length-1],c=_.find(b.frameworks,function(b){return b.id==a.serviceid});a.selectedService={id:c.id,active:c.active,registered_time:new Date(1e3*c.registered_time).toGMTString(),hostname:c.hostname,name:c.name,webui_url:c.webui_url,status:"healthy",status_color:"greenyellow",activedTasks:0,tasks:[]},0==c.tasks.length?(a.selectedService.status="idle",a.selectedService.status_color="yellow"):_.each(c.tasks,function(b){"TASK_ERROR"!=b.state&&"TASK_FAILED"!=b.state&&"TASK_KILLED"!=b.state&&"TASK_LOST"!=b.state||(a.selectedService.status="unhealthy",a.selectedService.status_color="coral");var c={name:b.name,state:b.state.substring(5),cpu:b.resources.cpus,mem:b.resources.mem};a.selectedService.tasks.push(c)}),a.taskNum={taskNum:a.selectedService.tasks.length},a.selectedService.activedTasks=_.filter(c.tasks,function(a){return"TASK_RUNNING"==a.state}).length}}a.serviceid=e.serviceid,a.openService=function(){b.open(a.selectedService.webui_url,"_blank")},a.close=function(b){d.close(b),c.cancel(a.refreshChartsTimer)},a.showCharts=function(){var b=[];b.push(function(){i("service-cpu-chart")}),b.push(function(){j("service-mem-chart")}),b.push(function(){k("service-disk-chart")}),b.push(function(){l()}),h(b),a.refreshChartsTimer=c(a.showCharts,1e3)},a.changeSortBy=function(b){var c=a.sortBy.substring(1);c==b&&"-"==a.sortBy.substring(0,1)?a.sortBy="+"+b:a.sortBy="-"+b};var m=function(){a.sortBy="-state",c(function(){window.charts={},a.showCharts()},200)};m()}]).controller("nodePopupController",["$scope","$timeout","$modalInstance","model","calculateService","chartsService",function(a,b,c,d,e,f){function g(a){if(0!=a.length){var c=a.shift();c(),b(function(){g(a)},0)}}function h(b){if(0!=window.clusterState.length){for(var c=["Time(s)","Allocation Rate(占用率)"],d=[],g=0;g<window.clusterState.length;g++){var h=window.clusterState[g],i=[];i.push(g+1-window.clusterState.length+"s"),i.push(e.calculateCpuAllocationRateForNode(h,a.nodeid)[0]),d.push(i)}var j=e.calculateCpuAllocationRateForNode(window.clusterState[window.clusterState.length-1],a.nodeid);a.currentUsedCPU=j[1],f.drawLineChart(c,d,b,"%(百分比)")}}function i(b){if(0!=window.clusterState.length){for(var c=["Time(s)","Allocation Rate(占用率)"],d=[],g=0;g<window.clusterState.length;g++){var h=window.clusterState[g],i=[];i.push(g+1-window.clusterState.length+"s"),i.push(e.calculateMemAllocationRateForNode(h,a.nodeid)[0]),d.push(i)}var j=e.calculateMemAllocationRateForNode(window.clusterState[window.clusterState.length-1],a.nodeid);a.currentUsedMem=j[1],f.drawLineChart(c,d,b,"%(百分比)")}}function j(b){if(0!=window.clusterState.length){for(var c=["Time(s)","Allocation Rate(占用率)"],d=[],g=0;g<window.clusterState.length;g++){var h=window.clusterState[g],i=[];i.push(g+1-window.clusterState.length+"s"),i.push(e.calculateDiskAllocationRateForNode(h,a.nodeid)[0]),d.push(i)}var j=e.calculateDiskAllocationRateForNode(window.clusterState[window.clusterState.length-1],a.nodeid);a.currentUsedDisk=j[1],f.drawLineChart(c,d,b,"%(百分比)")}}function k(){if(0!=window.clusterState.length){var b=window.clusterState[window.clusterState.length-1],c=_.find(b.slaves,function(b){return b.id==a.nodeid});a.selectedNode={id:c.id,active:c.active,registered_time:new Date(1e3*c.registered_time).toGMTString(),hostname:c.hostname,master_version:b.version,activedTasks:0,tasks:[]},_.each(b.frameworks,function(b){_.each(b.tasks,function(b){if(b.slave_id==a.nodeid){var c={name:b.name,state:b.state.substring(5),cpu:b.resources.cpus,mem:b.resources.mem};a.selectedNode.tasks.push(c)}})}),a.taskNum={taskNum:a.selectedNode.tasks.length},a.selectedNode.activedTasks=_.filter(a.selectedNode.tasks,function(a){return"RUNNING"==a.state}).length}}a.nodeid=d.nodeid,a.close=function(d){c.close(d),b.cancel(a.refreshChartsTimer)},a.showCharts=function(){var c=[];c.push(function(){h("node-cpu-chart")}),c.push(function(){i("node-mem-chart")}),c.push(function(){j("node-disk-chart")}),c.push(function(){k()}),g(c),a.refreshChartsTimer=b(a.showCharts,1e3)},a.changeSortBy=function(b){var c=a.sortBy.substring(1);c==b&&"-"==a.sortBy.substring(0,1)?a.sortBy="+"+b:a.sortBy="-"+b};var l=function(){a.sortBy="-state",b(function(){window.charts={},a.showCharts()},200)};l()}]),linkerCloud.controller("ServicesController",["$scope","$timeout","$filter","$location","calculateService","chartsService","popupService",function(a,b,c,d,e,f,g){function h(){if("/services"!=d.path())return void b.cancel(a.refreshServices);if(0==window.clusterState.length)return void(a.refreshServices=b(h,1e3));for(var c=["Time(s)","Allocation Rate(占用率)"],g=[],i=0;i<window.clusterState.length;i++){var j=window.clusterState[i],k=[];k.push(i+1-window.clusterState.length+"s"),k.push(e.calculateAllocationRateForAllServices(j,a.chartFor)),g.push(k)}a.serviceNum.serviceNum=window.clusterState[window.clusterState.length-1].frameworks.length,f.drawLineChart(c,g,"service-allocation-chart","%(百分比)"),a.getLastestServices(),a.switchStatusFilter(),a.refreshServices=b(h,1e3)}a.switchCharts=function(b){switch(a.chartFor=b,b){case"services.cpu":$("#btnForCpu").addClass("btn-group-selected"),$("#btnForMem").removeClass("btn-group-selected"),$("#btnForDisk").removeClass("btn-group-selected"),h();break;case"services.memory":$("#btnForCpu").removeClass("btn-group-selected"),$("#btnForMem").addClass("btn-group-selected"),$("#btnForDisk").removeClass("btn-group-selected"),h();break;case"services.disk":$("#btnForCpu").removeClass("btn-group-selected"),$("#btnForMem").removeClass("btn-group-selected"),$("#btnForDisk").addClass("btn-group-selected"),h()}},a.switchStatusFilter=function(b){switch(_.isUndefined(b)||(a.statusFilter=b),a.statusFilter){case"":$("#statusAll").addClass("btn-group-selected"),$("#statusHealthy").removeClass("btn-group-selected"),$("#statusUnhealthy").removeClass("btn-group-selected"),$("#statusUnknown").removeClass("btn-group-selected");break;case"healthy":$("#statusAll").removeClass("btn-group-selected"),$("#statusHealthy").addClass("btn-group-selected"),$("#statusUnhealthy").removeClass("btn-group-selected"),$("#statusUnknown").removeClass("btn-group-selected");break;case"unhealthy":$("#statusAll").removeClass("btn-group-selected"),$("#statusHealthy").removeClass("btn-group-selected"),$("#statusUnhealthy").addClass("btn-group-selected"),$("#statusUnknown").removeClass("btn-group-selected");break;case"other":$("#statusAll").removeClass("btn-group-selected"),$("#statusHealthy").removeClass("btn-group-selected"),$("#statusUnhealthy").removeClass("btn-group-selected"),$("#statusUnknown").addClass("btn-group-selected")}},a.getLastestServices=function(){a.serviceNum_Healthy=0,a.serviceNum_Unhealthy=0,a.serviceNum_Unknown=0,a.services=[];var b=window.clusterState[window.clusterState.length-1];_.each(b.frameworks,function(b){var c={id:b.id,name:b.name,status:"healthy",status_color:"#2ecc71",tasks:b.tasks.length,cpu:b.used_resources.cpus,mem:b.used_resources.mem,disk:b.used_resources.disk};a.serviceNum_Healthy+=1,0==b.tasks.length?(c.status="other",c.status_color="burlywood",a.serviceNum_Unknown+=1,a.serviceNum_Healthy-=1):_.each(b.tasks,function(b){"TASK_ERROR"!=b.state&&"TASK_FAILED"!=b.state&&"TASK_KILLED"!=b.state&&"TASK_LOST"!=b.state||(c.status="unhealthy",c.status_color="#ed5565",a.serviceNum_Unhealthy+=1,a.serviceNum_Healthy-=1)}),a.services.push(c)})},a.filterServices=function(){var b=a.services;return b=c("filter")(b,a.statusFilter),b=c("serviceFilterForSpecifiedFields")(b,a.searchFilter)},a.openServicePopup=function(a){g.openServicePopup(a)},a.changeSortBy=function(b){var c=a.sortBy.substring(1);c==b&&"-"==a.sortBy.substring(0,1)?a.sortBy="+"+b:a.sortBy="-"+b};var i=function(){window.charts={},a.serviceNum={serviceNum:0},a.statusFilter="",a.searchFilter="",a.sortBy="-status",b(function(){a.switchCharts("services.cpu")},1e3)};i()}]).filter("serviceFilterForSpecifiedFields",[function(){return function(a,b){if(angular.isUndefined(a)||angular.isUndefined(b))return a;var c=[];return angular.forEach(a,function(a){(a.name.indexOf(b)>=0||a.status.indexOf(b)>=0||a.tasks.toString().indexOf(b)>=0||a.cpu.toString().indexOf(b)>=0||a.mem.toString().indexOf(b)>=0||a.disk.toString().indexOf(b)>=0)&&c.push(a)}),c}}]),linkerCloud.factory("calculateService",[calculateService]),linkerCloud.factory("chartsService",[chartsService]),linkerCloud.factory("mesosAPIService",["$http","$q","$modal",mesosAPIService]),linkerCloud.factory("popupService",["$window","$modal",popupService]);